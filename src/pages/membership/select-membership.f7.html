<template>
	<div class="page" id="select-membership">
		<div class="artwork"></div>
		<div class="navbar">
			<div class="navbar-inner sliding">
				<div class="header-cont">
					<div class="header">
						<!-- <a id="membership-select-back" href="" class="back-btn back"> -->
						<a id="membership-select-back" href="" class="back-btn">
							<i class="icons material-icons">chevron_left</i>
						</a>
						<h1 class="title">{{localize "select_package"}}</h1>
						<div class="none"></div>
					</div>
				</div>
			</div>
		</div>
		<div class="page-content">
			<div class="text-cont">
				<h1 class="title2">{{localize "choose_plan"}}</h1>
				<p class="text">{{localize "down_and_up"}}</p>
			</div>
			<div class="plans-cont">
				<div class="btns-cont">
					<a class="button-plan plan-a active" id="plan-a">
						<h2 class="title-plan">{{localize "basic"}}</h2>
						<div class="price-cont">
							<p class="symbol">$</p>
							<p class="price">5</p>
						</div>
						<p class="per-month">{{localize "per_month"}}</p>
					</a>
					<a class="button-plan plan-b" id="plan-b">
						<h2 class="title-plan">{{localize "standard"}}</h2>
						<div class="price-cont">
							<p class="symbol">$</p>
							<p class="price">15</p>
						</div>
						<p class="per-month">{{localize "per_month"}}</p>
					</a>
					<a class="button-plan plan-c" id="plan-c">
						<h2 class="title-plan">{{localize "premium"}}</h2>
						<div class="price-cont">
							<p class="symbol">$</p>
							<p class="price">25</p>
						</div>
						<p class="per-month">{{localize "per_month"}}</p>
					</a>
				</div>
				<p class="title3">{{localize "text_notes"}}</p>
				<div class="icons-cont" id="text-notes">
					<div class="icon">
						<span id="package-a-tex-notes" class="plan plan-a material-icons active">done</span>
					</div>
					<div class="icon">
						<span id="package-b-tex-notes" class="plan plan-b material-icons">done</span>
					</div>
					<div class="icon">
						<span id="package-c-tex-notes" class="plan plan-c material-icons">done</span>
					</div>
				</div>
				<p class="title3">{{localize "pictures"}}</p>
				<div class="icons-cont" id="pictures">
					<div class="icon">
						<span id="package-a-pictures" class="plan plan-a material-icons active">done</span>
					</div>
					<div class="icon">
						<span id="package-b-pictures" class="plan plan-b material-icons">done</span>
					</div>
					<div class="icon">
						<span id="package-c-pictures" class="plan plan-c material-icons">done</span>
					</div>
				</div>
				<p class="title3">Video</p>
				<div class="icons-cont" id="video">
					<div class="icon">
						<span id="package-a-video" class="plan plan-a material-icons active">clear</span>
					</div>
					<div class="icon">
						<span id="package-b-video" class="plan plan-b material-icons">done</span>
					</div>
					<div class="icon">
						<span id="package-c-video" class="plan plan-c material-icons">done</span>
					</div>
				</div>
				<p class="title3">GPS</p>
				<div class="icons-cont" id="gps">
					<div class="icon">
						<span id="package-a-gps" class="plan plan-a material-icons active">clear</span>
					</div>
					<div class="icon">
						<span id="package-b-gps" class="plan plan-b material-icons">clear</span>
					</div>
					<div class="icon">
						<span id="package-c-gps" class="plan plan-c material-icons">done</span>
					</div>
				</div>
				<p class="title3">{{localize "on_demand"}}</p>
				<div class="icons-cont" id="demand">
					<div class="icon">
						<span id="package-a-demand" class="plan plan-a material-icons active">clear</span>
					</div>
					<div class="icon">
						<span id="package-b-demand" class="plan plan-b material-icons">clear</span>
					</div>
					<div class="icon">
						<span id="package-c-demand" class="plan plan-c material-icons">done</span>
					</div>
				</div>
				<div class="desc-cont">
					<div class="item">
						<p id="package-a-desc" class="plan plan-a active">6 {{localize "desc_select_membership"}}</p>
					</div>
					<div class="item">
						<p id="package-b-desc" class="plan plan-b">6 {{localize "desc_select_membership"}}</p>
					</div>
					<div class="item">
						<p id="package-c-desc" class="plan plan-c">12 {{localize "desc_select_membership"}}</p>
					</div>
				</div>
			</div>
			<div class="btns-cont center">
				<!-- <a id="confirm-plan-btn" href="/membership/card/" class="button color-blue round large">Select plan</a> -->
				<a id="confirm-plan-btn" href="/membership/card/?plan=basic" class="button color-blue round large">{{localize "select_plan"}}</a>
			</div>
		</div>
	</div>
</template>
<script>
	import $$ from "dom7";
	export default {
		// auth/local/register
		on: {
			pageInit: async function (e, page) {
				var self = this;
				var app = self.$app;
				
				var queryID = app.views.main.router.currentRoute.params.userID;
				var clearOnBack = app.views.main.router.currentRoute.params.clearOnBack;

				
				console.log("select-membership pageInit");
				console.log(queryID);
				var selectedPlan = "basic";
				
				console.log("**Previous Path**")
				console.log(app.views.main.router.previousRoute.route);

				changeConfirmButtonHref(selectedPlan);

				$$(".button-plan").click(function (val) {
					let el = $$(this);
					console.log(el);
					if (!el.hasClass("active")) {
						selectedPlan = getIndex(el[0].id);
						// el[0].href = selectedPlan;
						changeConfirmButtonHref(selectedPlan);
						el.siblings(".active").removeClass("active");
						el.addClass("active");
						$$(".plan").removeClass("active");
						$$("."+el.attr('id')).addClass("active");
					}
				});
				
				$$("#membership-select-back").click(async function (val){
					if (await app.methods.userHasValidMembership())
					{
						console.log("membership was valid, not clearing it c:");
						await app.views.main.router.navigate(`/membership/view/user/${queryID}`);
					}
					else
					{
						val.preventDefault();
						console.log("membership not valid, clearing user");
						await app.methods.clearCurrentUser();
						console.log("user should now be null!!");
						console.log(await app.methods.getLocalValue('loggedUser'));
						console.log("Going to login now");
						await app.views.main.router.navigate('/');
					}
				})

				function changeConfirmButtonHref(extraRef)
				{
					// console.log($$("#confirm-plan-btn"));
					$$("#confirm-plan-btn")[0].href = `/membership/card/user/${queryID}/plan/${extraRef}`;
				}
				
				function getIndex(buttonId)
				{
					switch(buttonId)
					{
						case "plan-a":
						return "basic";
						case "plan-b":
						return "standard";
						case "plan-c":
						return "premium";
					}
				}
			},
		},
	};
</script>

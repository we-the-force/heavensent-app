<template>
	<div class="page" id="home-memories">
		<div class="artwork"></div>
		<div class="navbar">
			<div class="navbar-inner sliding">
				<div class="header-cont">
					<div class="header">
						<a href="" class="menu-btn panel-open" data-panel=".panel-left">
							<i class="icons material-icons">menu</i>
						</a>
						<div class="title-sub">
							<h1 id="logged-user-name" class="title capitalize"></h1>
							<p id="logged-user-membership" class="subtitle capitalize">Membership</p>
						</div>
						<a href="" class="avatar-fab item-link smart-select smart-select-init" data-open-in="popover">
							<!-- llenar select con usuarios -->
							<select id="users">
								<option value="1" selected>Ramona</option>
								<!-- poner selected al usuario que esta actualmente -->
								<option value="2">Envy</option>
								<option value="3">Lisa</option>
								<option value="4">Neil</option>
								<option value="5">Kim</option>
								<option value="6">Roxy</option>
								<option value="7">Wallace</option>
							</select>
							<img id="logged-user-picture" src="" alt="">
						</a>
					</div>
				</div>
			</div>
		</div>
		<!-- agregar o quitar none de toolbar para quitarlo y ponerlo -->
		<div class="toolbar toolbar-bottom">
			<div class="toolbar-inner">
				<a class="item-link">
					<i class="icon material-icons cloud">cloud</i>
					<span class="tabbar-label">My memories</span>
				</a>
				<a class="item-link" href="/memories/dashboard/user/{{CurrentUser.id}}">
					<div class="custom-icon">
						<i class="icon material-icons cloud grey">cloud</i>
						<i class="icon material-icons people">people</i>
					</div>
					<span class="tabbar-label two">Shared with me</span>
				</a>
			</div>
		</div>
		<div class="page-content" id="home-memories">
			<div class="sqr_bck" id="sqr1"></div>
			<div class="sqr_bck" id="sqr2"></div>
			<div class="sqr_bck" id="sqr3"></div>
			<div class="contacts-cont">
				<div class="contacts-title">Contacts</div>
				<a href="/contact/create" class="add-btn">
					<i class="icons material-icons">add</i>
				</a>
			</div>
			<div data-space-between="25" data-slides-per-view="3.3"
				class="swiper-container swiper-init contacts-swiper">
				<div class="swiper-wrapper">
					{{#each Contacts}}
					<div class="swiper-slide">
						<div class="person-cont">
							<a href="#" class="avatar-person popover-open" data-user="{{id}}"
								data-popover=".popover-person">
								{{#js_if "this.profilePicture != ''"}}
								<img src="{{@root.Server}}{{picture}}" alt="" srcset="">
								{{else}}
								<img src="" alt="" srcset="">
							</a>
							<p class="name-person">{{name}}</p>
						</div>
					</div>
					{{/each}}
				</div>
			</div>
			<div class="create-title">Create</div>
			<div data-space-between="10" data-slides-per-view="1.1" class="swiper-container swiper-init create-swiper">
				<div class="swiper-wrapper">
					<div class="swiper-slide">
						<div class="card simple memory" id="new">
							<img src="../../static/img/Pluma_card.png" alt="" srcset="">
							<div class="card-content">
								<p> New Memory </p>
							</div>
						</div>
					</div>
					<div class="swiper-slide">
						<div class="card simple memory" id="birthday">
							<img src="../../static/img/Regalo_card.png" alt="" srcset="">
							<div class="card-content">
								<p> Birthday Memory </p>
							</div>
						</div>
					</div>
					<div class="swiper-slide">
						<div class="card simple memory" id="colagge">
							<img src="../../static/img/sqrs.png" alt="" srcset=""
								style="margin-left: 4px; margin-top: 2px;">
							<div class="card-content">
								<p> Colagge </p>
							</div>
						</div>
					</div>
					<div class="swiper-slide">
						<div class="card simple memory" id="special">
							<img src="../../static/img/Pluma_card_tail.png" alt="" srcset="">
							<div class="card-content">
								<p> Especial Memory </p>
							</div>
						</div>
					</div>
				</div>
			</div>
			{{#js_if "(this.Memories.pending.length + this.Memories.scheduled.length) > 0"}}
			{{#js_if "this.Memories.scheduled.length > 0"}}
			<div class="scheduled-title">Scheduled</div>
			<div data-space-between="10" data-slides-per-view="1.1"
				class="swiper-container swiper-init sheduled-swiper">
				<div class="swiper-wrapper">
					{{#each Memories.scheduled}}
					<div class="swiper-slide">
						<div class="card complete v1">
							<div class="card-header">
								<div class="title-card">
									<h1>{{name}}</h1>
									<p>{{deliveryDate}}</p>
								</div>
								<a href="#" class="edit memory-options popover-open" data-popover=".popover-opt" data-memory="{{id}}">
									<span class="material-icons">more_horiz</span>
								</a>
							</div>
							<div class="card-content">
								{{#js_if "this.cover != ''"}}
								<div class="cover">
									<!-- <img src="../../static/img/paisaje.jpeg" alt="" srcset=""> -->
									<img src="{{@root.Server}}{{cover}}" alt="" srcset="">
								</div>
								{{else}}
								{{/js_if}}
								<img src="" alt="" srcset="">
								<div class="icons">
									<a href="#">
										<span class="material-icons">comment</span>
									</a>
									<a href="#">
										<span class="material-icons">image</span>
									</a>
									<a href="#">
										<span class="material-icons active">videocam</span>
									</a>
									<a href="#">
										<span class="material-icons">mic</span>
									</a>
									<a href="#">
										<span class="material-icons active">pin_drop</span>
									</a>
									<a href="#">
										<span class="material-icons">play_circle_filled</span>
									</a>
								</div>
							</div>
							<div class="card-footer">
								<div class="contacts">
									{{#each contacts.limitedUrls}}
									{{#js_if "this != ''"}}
									<img src="{{@root.Server}}{{this}}" alt="" class="person">
									{{else}}
									<img src="../../static/img/Busto.png" alt="" class="person">
									{{/js_if}}
									{{/each}}
									{{#js_if "this.contacts.extraContacts > 0"}}
									<div class="person plus">
										<p>+{{this.contacts.extraContacts}}</p>
									</div>
									{{/js_if}}
								</div>
							</div>
						</div>
					</div>
					{{/each}}
				</div>
			</div>
			{{/js_if}}
			{{#js_if "this.Memories.pending.length > 0"}}
			<div class="later-title">Send later</div>
			<div data-space-between="10" data-slides-per-view="1.1" class="swiper-container swiper-init later-swiper">
				<div class="swiper-wrapper">
					{{#each Memories.pending}}
					<div class="swiper-slide">
						<div class="card complete v1">
							<div class="card-header">
								<div class="title-card">
									<h1>{{name}}</h1>
									<p>{{deliveryDate}}</p>
								</div>
								<a href="#" class="edit popover-open" data-popover=".popover-opt" data-memory="{{id}}">
									<span class="material-icons">more_horiz</span>
								</a>
							</div>
							<div class="card-content">
								{{#js_if "this.cover != ''"}}
								<div class="cover">
									<!-- <img src="../../static/img/paisaje.jpeg" alt="" srcset=""> -->
									<img src="{{@root.Server}}{{cover}}" alt="" srcset="">
								</div>
								{{else}}
								{{/js_if}}
								<img src="" alt="" srcset="">
								<div class="icons">
									<a href="#">
										<span class="material-icons">comment</span>
									</a>
									<a href="#">
										<span class="material-icons">image</span>
									</a>
									<a href="#">
										<span class="material-icons active">videocam</span>
									</a>
									<a href="#">
										<span class="material-icons">mic</span>
									</a>
									<a href="#">
										<span class="material-icons active">pin_drop</span>
									</a>
									<a href="#">
										<span class="material-icons">play_circle_filled</span>
									</a>
								</div>
							</div>
							<div class="card-footer">
								<div class="contacts">
									{{#each contacts.limitedUrls}}
									{{#js_if "this != ''"}}
									<img src="{{@root.Server}}{{this}}" alt="" class="person">
									{{else}}
									<img src="" alt="" class="person">
									{{/js_if}}
									{{/each}}
									{{#js_if "this.contacts.extraContacts > 0"}}
									<div class="person plus">
										<p>+{{this.contacts.extraContacts}}</p>
									</div>
									{{/js_if}}
								</div>
							</div>
						</div>
					</div>
					{{/each}}
				</div>
			</div>
			{{/js_if}}
			{{else}}

			{{/js_if}}
			<div class="donate-title">Donate</div>
			<div data-space-between="10" data-slides-per-view="1.1" class="swiper-container swiper-init donate-swiper">
				<div class="swiper-wrapper">
					{{#each Fundations}}
					<div class="swiper-slide">
						<div class="card card-expandable">
							<div class="card-content">
								<div class="bg-video">
									{{#js_if "this.cover != ''"}}
									<img src="{{@root.Server}}{{cover}}">
									{{else}}

									{{/js_if}}
									<div class="sqr_bck" id="sqr6"></div>
									<div class="sqr_bck" id="sqr7"></div>
									<div class="sqr_bck" id="sqr8"></div>
									<span class="material-icons play card-opened-fade-out">play_circle_outline</span>
								</div>
								<div class="card-content-padding">
									<div class="btns-cont card-opened-fade-out">
										<a href="#" class="btn-card card-prevent-open" data-fundation="{{id}}">Give
											now</a>
									</div>
									<p class="card-opened-fade-in">{{desc}}</p>
								</div>
							</div>
						</div>
					</div>
					{{/each}}
					<!-- <div class="swiper-slide">
						<div class="card card-expandable">
							<div class="card-content">
								<div class="bg-video">
									<div class="sqr_bck" id="sqr6"></div>
									<div class="sqr_bck" id="sqr7"></div>
									<div class="sqr_bck" id="sqr8"></div>
									<span class="material-icons play card-opened-fade-out">play_circle_outline</span>
								</div>
								<div class="card-content-padding">
									<div class="btns-cont card-opened-fade-out">
										<a href="#" class="btn-card card-prevent-open">Give now</a>
									</div>
									<p class="card-opened-fade-in">Lorem ipsum dolor sit amet, consectetur adipiscing
										elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim
										ad minim veniam, quis nostrud exercitation ullamco laboris porem ipsum dolor sit
										amet, consectetur adipiscing elit, sed do eiusmod tempor</p>
								</div>
							</div>
						</div>
					</div>
					<div class="swiper-slide">
						<div class="card card-expandable">
							<div class="card-content">
								<div class="bg-video">
									<div class="sqr_bck" id="sqr6"></div>
									<div class="sqr_bck" id="sqr7"></div>
									<div class="sqr_bck" id="sqr8"></div>
									<span class="material-icons play card-opened-fade-out">play_circle_outline</span>
								</div>
								<div class="card-content-padding">
									<div class="btns-cont card-opened-fade-out">
										<a href="#" class="btn-card card-prevent-open">Give now</a>
									</div>
									<p class="card-opened-fade-in">Lorem ipsum dolor sit amet, consectetur adipiscing
										elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim
										ad minim veniam, quis nostrud exercitation ullamco laboris porem ipsum dolor sit
										amet, consectetur adipiscing elit, sed do eiusmod tempor</p>
								</div>
							</div>
						</div>
					</div>
					<div class="swiper-slide">
						<div class="card card-expandable">
							<div class="card-content">
								<div class="bg-video">
									<div class="sqr_bck" id="sqr6"></div>
									<div class="sqr_bck" id="sqr7"></div>
									<div class="sqr_bck" id="sqr8"></div>
									<span class="material-icons play card-opened-fade-out">play_circle_outline</span>
								</div>
								<div class="card-content-padding">
									<div class="btns-cont card-opened-fade-out">
										<a href="#" class="btn-card card-prevent-open">Give now</a>
									</div>
									<p class="card-opened-fade-in">Lorem ipsum dolor sit amet, consectetur adipiscing
										elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim
										ad minim veniam, quis nostrud exercitation ullamco laboris porem ipsum dolor sit
										amet, consectetur adipiscing elit, sed do eiusmod tempor</p>
								</div>
							</div>
						</div>
					</div> -->
				</div>
			</div>
			<div class="footer">
				<div class="sqr_bck" id="sqr4"></div>
				<div class="sqr_bck" id="sqr5"></div>
			</div>
		</div>
		<div class="popover popover-opt">
			<div class="popover-inner">
				<div class="list">
					<ul>
						<li><a id="edit-memory-btn" class="list-button item-link popover-close" href="#">Edit</a></li>
						<li><a class="list-button item-link" href="#">Delete</a></li>
					</ul>
				</div>
			</div>
		</div>
		<div class="popover popover-person">
			<div class="popover-inner">
				<div class="list">
					<ul>
						<li><a id="edit-contact-btn" class="list-button item-link popover-close" href="#">Edit
								profile</a>
						</li>
						<li><a class="list-button item-link popover-close" href="#">Create Memory</a></li>
					</ul>
				</div>
			</div>
		</div>
	</div>
</template>
<script>
	import $$ from "dom7";
	import localforage from "localforage";
	export default {
		on: {
			pageInit: async function (e, page) {
				var self = this;
				var app = self.$app;

				console.log("home-memories pageInit [pageInit], updating user");

				await app.methods.updateCurrentUser();
				await app.methods.loadContacts();
				var loggedUser = await app.methods.getLocalValue('loggedUser');

				if (loggedUser == null) {
					app.dialog.alert("There was a problem getting your account, please contact support about this issue.");
					app.views.main.router.navigate('/');
				}

				await updateControls();
				if (isOverflown($$('.header h1.title')[0])) {
					$$('.header h1.title').css('font-size', '18px');
				}

				/* aqui esta este pedo */

				$$('select#users').change(function (el) {
					let select = app.smartSelect.get('.smart-select');
					select.close(); /* cierra el popover */
					console.log(select.getValue()); /* valor del id */
				});

				$$('.avatar-person').on('click', function (val) {
					console.log($$(this).prop("dataset").user);
					$$('#edit-contact-btn')[0].href = "/contact/edit/contact/" + $$(this).prop("dataset").user;
					console.log($$('.popover-person'));
				})

				$$('.memory-options').on('click', function(val){
					$$('#edit-memory-btn')[0].href = "/memories/create/" + $$(this).prop("dataset").memory;
				})

				$$('.card.memory').click(function (val) {
					console.log($$(this).attr('id'));
					switch ($$(this).attr('id')) {
						case 'new':
							app.views.main.router.navigate('/memories/create/-1');
							break;
						case 'birthday':
							app.views.main.router.navigate('/memories/birthday');
							break;
						case 'colagge':
							break;
						case 'special':
							break;
					}
				});

				$$('.card-expandable').on('card:open', x => {
					let swiper = app.swiper.get('.donate-swiper');
					swiper.allowTouchMove = false;
				});

				$$('.card-expandable').on('card:close', x => {
					let swiper = app.swiper.get('.donate-swiper');
					swiper.allowTouchMove = true;
				});

				$$('.card-expandable .btn-card').click(x => {
					console.log('make somthing');

				});

				function updateControls() {
					if (loggedUser != null) {
						var currentMembership = loggedUser.currentMembership;
						if (currentMembership === null) {
							currentMembership = "No Membership";
						}
						else {
							currentMembership = loggedUser.currentMembership.plan.name + " membership";
						}

						$$("#logged-user-name")[0].textContent = loggedUser.name != undefined ? loggedUser.name : loggedUser.username;
						$$("#logged-user-membership")[0].textContent = currentMembership;
						if (loggedUser.profilePicture != null) {
							$$("#logged-user-picture")[0].src = `${app.data.server}${loggedUser.profilePicture.url}`;
						}
					}
					else {
						console.log("User was null, not updating anything [pageInit.updateControls]");
					}
				}

				function isOverflown(element) {
					return element.scrollHeight > element.clientHeight || element.scrollWidth > element.clientWidth;
				}
			},
		},
	};
</script>
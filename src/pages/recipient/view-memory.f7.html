<template>
    <div class="page" id="view-memory">
        <div class="artwork"></div>
        <div class="navbar">
            <div class="navbar-inner sliding">
                <div class="header-cont">
                    <div class="header">
                        <a id="view-memory-back-btn" href="/memories/dashboard/user/{{CurrentUser}}/{{SwiperID}}" class="back-btn">
                            <i class="icons material-icons">chevron_left</i>
                        </a>
                        <h1 class="title"></h1>
                        <a href="" class="share-btn popup-open" data-popup=".popup-share">
                            <i class="icons material-icons">share</i>
                        </a>
                    </div>
                </div>
            </div>
        </div>
        <div class="page-content">
            <div class="sqr_bck" id="sqr1"></div>
            <div class="sqr_bck" id="sqr2"></div>
            <h1 class="title">Jacob Ethan Goodbye</h1>
            <div class="cover">
                <img src="static/img/background.jpg" alt="">
            </div>
            <p class="desc">Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut
                labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris</p>
            <div class="tabbar">
                <a href="#comments" class="memory-tab tab-link tab-link-active" id="comment"><span
                        class="material-icons">comments</span></a>
                <a href="#images" class="memory-tab tab-link" id="image"><span class="material-icons">image</span></a>
                <a href="#videos" class="memory-tab tab-link" id="video"><span
                        class="material-icons">videocam</span></a>
                <a href="#audios" class="memory-tab tab-link" id="audio"><span class="material-icons">mic</span></a>
            </div>
            <div class="tabs-animated-wrap">
                <div class="tabs">
                    <div id="comments" class="tab tab-active">
                        <!-- <div class="item">
                            <div class="image">
                                <img src="static/img/paisaje.jpeg" alt="">
                            </div>
                        </div>
                        <div class="item">
                            <div class="image">
                                <img src="static/img/envy.jpg" alt="">
                            </div>
                        </div>
                        <div class="item">
                            <div class="image">
                                <img src="static/img/paisaje.jpeg" alt="">
                            </div>
                        </div>
                        <div class="item">
                            <div class="image">
                                <img src="static/img/paisaje.jpeg" alt="">
                            </div>
                        </div>
                        <div class="item">
                            <div class="image">
                                <img src="static/img/paisaje.jpeg" alt="">
                            </div>
                        </div>
                        <div class="item">
                            <div class="image">
                                <img src="static/img/paisaje.jpeg" alt="">
                            </div>
                        </div>
                        <div class="item">
                            <div class="image">
                                <img src="static/img/ramona.jpeg" alt="">
                            </div>
                        </div>
                        <div class="item">
                            <div class="image">
                                <img src="static/img/paisaje.jpeg" alt="">
                            </div>
                        </div> -->
                    </div>
                    <div id="images" class="tab">
                        <!-- <div class="item">
                            <div class="image">
                                <img src="static/img/paisaje.jpeg" alt="">
                            </div>
                        </div>
                        <div class="item">
                            <div class="image">
                                <img src="static/img/paisaje.jpeg" alt="">
                            </div>
                        </div>
                        <div class="item">
                            <div class="image">
                                <img src="static/img/paisaje.jpeg" alt="">
                            </div>
                        </div>
                        <div class="item">
                            <div class="image">
                                <img src="static/img/paisaje.jpeg" alt="">
                            </div>
                        </div>
                        <div class="item">
                            <div class="image">
                                <img src="static/img/paisaje.jpeg" alt="">
                            </div>
                        </div> -->
                    </div>
                    <div id="videos" class="tab">
                        <!-- <div class="item">
                            <div class="image">
                                <img src="static/img/paisaje.jpeg" alt="">
                            </div>
                        </div>
                        <div class="item">
                            <div class="image">
                                <img src="static/img/paisaje.jpeg" alt="">
                            </div>
                        </div>
                        <div class="item">
                            <div class="image">
                                <img src="static/img/paisaje.jpeg" alt="">
                            </div>
                        </div> -->
                    </div>
                    <div id="audios" class="tab">
                        <!-- <div class="item">
                            <div class="image">
                                <img src="static/img/paisaje.jpeg" alt="">
                            </div>
                        </div>
                        <div class="item">
                            <div class="image">
                                <img src="static/img/paisaje.jpeg" alt="">
                            </div>
                        </div>
                        <div class="item">
                            <div class="image">
                                <img src="static/img/paisaje.jpeg" alt="">
                            </div>
                        </div>
                        <div class="item">
                            <div class="image">
                                <img src="static/img/paisaje.jpeg" alt="">
                            </div>
                        </div>
                        <div class="item">
                            <div class="image">
                                <img src="static/img/paisaje.jpeg" alt="">
                            </div>
                        </div>
                        <div class="item">
                            <div class="image">
                                <img src="static/img/paisaje.jpeg" alt="">
                            </div>
                        </div>
                        <div class="item">
                            <div class="image">
                                <img src="static/img/paisaje.jpeg" alt="">
                            </div>
                        </div>
                        <div class="item">
                            <div class="image">
                                <img src="static/img/paisaje.jpeg" alt="">
                            </div>
                        </div>
                        <div class="item">
                            <div class="image">
                                <img src="static/img/paisaje.jpeg" alt="">
                            </div>
                        </div> -->
                    </div>
                </div>
            </div>
            <div class="footer">
                <div class="sqr_bck" id="sqr3"></div>
                <div class="sqr_bck" id="sqr4"></div>
            </div>

        </div>

        <div class="popup popup-share">
            <div class="background">
                <div class="sqr_bck" id="sqr1"></div>
                <div class="sqr_bck" id="sqr2"></div>
                <div class="sqr_bck" id="sqr3"></div>
            </div>
            <div class="pop-header">
                <a class="sms">
                    <img src="static/icons/sms.png" alt="">
                    <p>{{localize "message"}}</p>
                </a>
                <a class="face">
                    <img src="static/icons/face.png" alt="">
                    <p>Facebook</p>
                </a>
                <a class="whats">
                    <img src="static/icons/whats.png" alt="">
                    <p>Whatâ€™sApp</p>
                </a>
                <a class="twit">
                    <img src="static/icons/twitter.png" alt="">
                    <p>Twitter</p>
                </a>
            </div>
            <div class="pop-cont">
                <div class="card simple prev">
                    <div class="card-header">
                        <div class="title-card">
                            <h1>Jacob Ethan Goodbye</h1>
                            <p class="sender">Sent by: Jacob Ethan</p>
                        </div>
                    </div>
                    <div class="card-content">
                        <div class="cover">
                            <img src="static/img/background.jpg" alt="">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</template>
<script>
    import $$ from "dom7";
    import localforage from "localforage";
    export default {
        on: {
            pageInit: async function(e, page) {
                var self = this;
                var app = self.$app;
                var media = [];

                var loggedUser = await app.methods.getLocalValue('loggedUser');

                var memory = page.route.context.Memory;

                /* -------------------------- temp fill data -------------------------------------*/
                // var memory = {};
                // memory.name = "Jacob Ethan Goodbye";
                // memory.owner = "owner";
                // memory.cover = "../../static/img/background.jpg";
                // memory.description = "Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris";
                // /* repetir docs con imagenes, videos, audios, y comentarios */
                // memory.docs = ["../../static/img/paisaje.jpeg", "../../static/img/envy.jpg", "../../static/img/ramona.jpeg"]; /* llenar array condocumentos */

                $$('.page-content .title').text(memory.title); /* llenar titulo */
                $$('.cover img').attr('src', app.data.server + memory.cover); /* llenar cover */
                $$('.desc').text(memory.desc); /* llenar descripcion */
                $$('.popup-share .pop-cont .title-card h1').text(memory.title); /* tarjeta de compartir */
                $$('.popup-share .pop-cont .title-card p').text(memory.owner);
                $$('.popup-share .pop-cont .cover img').attr('src', app.data.server + memory.cover); /* tarjeta de compartir */

                /* limpiar fotos */
                $$('.tabs #comments').empty();
                $$('.tabs #images').empty();
                $$('.tabs #videos').empty();
                $$('.tabs #audios').empty();

                memory.media.forEach(el => {
                    $$('.tabs #comments').append(
                        '<div class="item">' +
                        '<div class="image">' +
                        '<img src="' + app.data.server + el + '" alt="">' +
                        '</div>' +
                        '</div>'
                    );
                });

                memory.media.forEach(el => {
                    $$('.tabs #images').append(
                        '<div class="item">' +
                        '<div class="image">' +
                        '<img src="' + app.data.server + el + '" alt="">' +
                        '</div>' +
                        '</div>'
                    );
                });

                memory.media.forEach(el => {
                    $$('.tabs #videos').append(
                        '<div class="item">' +
                        '<div class="image">' +
                        '<img src="' + app.data.server + el + '" alt="">' +
                        '</div>' +
                        '</div>'
                    );
                });

                memory.media.forEach(el => {
                    $$('.tabs #audios').append(
                        '<div class="item">' +
                        '<div class="image">' +
                        '<img src="' + app.data.server + el + '" alt="">' +
                        '</div>' +
                        '</div>'
                    );
                });

                /* --------------------------- end fill data ----------------------------------- */

                $$('.tab-active').children().each((i, el) => {
                    media.push($$(el).find('img').attr('src'));
                });

                $$('.tab-active img').off('click').click(function(el) {
                    let index = $$(this).parent().parent().index();
                    galleryFunc(index);
                });

                $$('.tab').on('tab:show', function(params) {
                    let page = $$(this);
                    media = [];

                    page.children().each((i, el) => {
                        media.push($$(el).find('img').attr('src'));
                    });

                    $$('.tab-active img').off('click').click(function(el) {
                        let index = $$(this).parent().parent().index();
                        galleryFunc(index);
                    });
                });

                // if (!loggedUser)
                // {
                //     $$('#view-memory-back-btn').css('display','none')
                // }

                // $$('#view-memory-back-btn').on('click', function(params){
                //     console.log("Click!");
                //     if (loggedUser)
                //     {
                //         app.views.main.router.navigate(`/memories/dashboard/user/${loggedUser.id}`);
                //     }
                //     else
                //     {
                //         app.views.main.router.navigate(`/memories/dashboard/user/12`);
                //     }
                // });

                function galleryFunc(index) {
                    let gallery = app.photoBrowser.create({
                        photos: media,
                        theme: 'dark',
                        type: 'page',
                        toolbar: false,
                    });
                    gallery.open(index);
                    let nav = gallery.view.$el.find('.photo-browser-page').find('.navbar').length != 0 ? gallery.view.$el.find('.photo-browser-page').find('.navbar') : gallery.view.$el.find('.navbars').find('.navbar-photo-browser');
                    nav.html('<div class="navbar-inner sliding">' +
                        '<div class="header-cont">' +
                        '<div class="header">' +
                        '<a href="" class="back-btn back">' +
                        '<i class="icons material-icons">chevron_left</i>' +
                        '</a>' +
                        '<h1 class="title">' + memory.title + '</h1>' +
                        '<a href="" class="share-btn popup-open" data-popup=".popup-share">' +
                        '<i class="icons material-icons">share</i>' +
                        '</a>' +
                        '</div>' +
                        '</div>' +
                        '</div>');
                }
            }
        }
    }
</script>
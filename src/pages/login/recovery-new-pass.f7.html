<template>
	<div class="page" data-name="recovery-new-pass" id="recovery-new-pass">
        <div class="artwork"></div>
        <div class="navbar">
			<div class="navbar-inner sliding">
				<div class="header-cont">
					<div class="header">
						<a href="" class="back-btn back">
							<i class="icons material-icons">chevron_left</i>
						</a>
						<h1 class="title">{{localize "change_pass"}}</h1>
						<div class="none"></div>
					</div>
				</div>
			</div>
		</div>
		<div class="page-content" id="recovery-new-pass">
			<div class="sqr_bck" id="sqr1"></div>
			<div class="sqr_bck" id="sqr2"></div>
			<div class="sqr_bck" id="sqr3"></div>
			<div class="logo-cont">
				<div class="logo">
					<div class="background"></div>
					<img src="../../static/img/Pluma.png" alt="" />
				</div>
			</div>
			<div class="text-cont">
				<p class="text">
					{{localize "create_pass"}}
				</p>
			</div>
			<div class="inputs list">
				<ul>
					<li class="item-content item-input">
						<div class="item-inner">
							<div class="item-input-wrap">
								<input type="password" id="pass" placeholder="{{localize 'new_pass'}}" required validate />
								<i class="icons material-icons">edit</i>
								<!-- <span class="input-clear-button"></span> -->
							</div>
						</div>
					</li>
					<li class="item-content item-input">
						<div class="item-inner">
							<div class="item-input-wrap">
								<input type="password" id="pass_2" placeholder="{{localize 'repeat_pass'}}" required validate />
								<i class="icons material-icons">edit</i>
								<!-- <span class="input-clear-button"></span> -->
							</div>
						</div>
					</li>
				</ul>
			</div>
			<div class="btns-cont center">
				<a id="save-pass-btn" href="" class="button round color-blue large">{{localize "save_pass"}}</a>
			</div>
		</div>
	</div>
</template>
<script>
	import $$ from "dom7";
	export default {
		on: {
			pageInit: function (e, page) {
				var self = this;
				var app = self.$app;
				var currentCode = app.views.main.router.currentRoute.params.code;

				console.log(currentCode);

				$$('#save-pass-btn').click(function (val) {
					// app.request.promise.post(`${app.data.server}/auth/forgot-password`, {email: emailVal}).then(function(res){
					// 	console.log("email sent");
					// 	console.log(res);
					// 	app.views.main.router.navigate('/recovery/mailSend');
					// }).catch(function(err){
					// 	console.log("Error sending email");
					// 	console.log(err);
					// });

					let pass1 = $$('#pass').val();
					let pass2 = $$('#pass_2').val();

					console.log(`passes: (${pass}, ${pass_2})`);
					if (pass1 != '' && pass2 != '')
					{
						if (pass1 == pass2)
						{
							if (pass1.length >= 8)
							{
								app.request.promise.post(`${app.data.server}/auth/reset-password`, {
									code: currentCode,
									password: pass1,
									passwordConfirmation: pass2,
								}).then(function(res){
									console.log("The password has been reset");
									app.dialog.alert("Password has been successfully changed");
									app.views.main.router.navigate('/');
								}).catch(function(err){
									console.log("An error occurred!");
									console.log(err);
								});
							}
							else
							{
								app.dialog.alert("Password must be at least 8 characters long");
							}
						}
						else
						{
							app.dialog.alert("Both passwords must match!");
						}
					}
					else
					{
						app.dialog.alert("Please fill both password fields");
					}
				});
			},
		},
	};
</script>

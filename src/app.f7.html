<template>
	<div id="app">
		<div class="panel panel-left panel-cover panel-init">
			<div class="sqr_bck" id="sqr1"></div>
			<div class="sqr_bck" id="sqr2"></div>
			<div class="sqr_bck" id="sqr3"></div>
			<div class="profile">
				<div class="avatar">
					<img id="side-logged-user-picture" src="../../static/img/chris_evans_crop1569801286473.png" alt="">
				</div>
				<div class="text">
					<div class="name-cont">
						<h1   id="side-logged-user-name" class="name capitalize">Jacob Ethan</h1>
						<span class="material-icons">edit</span>
					</div>
					<p id="side-logged-user-membership">Membership</p>
				</div>
			</div>
			
			<div class="btns-cont">
				<a href="/memories/home" class="btn-panel panel-close active">Profile</a>
				<a id="app-plan-button" href="/membership/view/user/18" class="btn-panel panel-close ">Plan</a><!-- herdcoded -->
				<a href="#" class="btn-panel panel-close ">Donate</a>
			</div>
			
			<div class="footer">
				<a href="/UserAgreement" class="btn-end panel-close terms">Terms & Conditions</a>
				<a href="/" class="btn-end panel-close sign-out" id="sign-out-btn">Sign Out</a>
			</div>
		</div>
		
		<!-- Right panel with reveal effect-->
		<!-- <div class="panel panel-right panel-reveal theme-dark">
			<div class="view">
				<div class="page">
					<div class="navbar">
						<div class="navbar-bg"></div>
						<div class="navbar-inner">
							<div class="title">Right Panel</div>
						</div>
					</div>
					<div class="page-content">
						<div class="block">Right panel content goes here</div>
					</div>
				</div>
			</div>
		</div> -->
		
		<!-- Your main view, should have "view-main" class -->
		<div class="view view-main view-init safe-areas" data-url="/"></div>
		
		<!-- Popup -->
		<!-- <div class="popup" id="my-popup">
			<div class="view">
				<div class="page">
					<div class="navbar">
						<div class="navbar-bg"></div>
						<div class="navbar-inner">
							<div class="title">Popup</div>
							<div class="right">
								<a href="#" class="link popup-close">Close</a>
							</div>
						</div>
					</div>
					<div class="page-content">
						<div class="block">
							<p>Popup content goes here.</p>
						</div>
					</div>
				</div>
			</div>
		</div> -->
		
		<!-- Login Screen -->
		<!-- <div class="login-screen" id="my-login-screen">
			<div class="view">
				<div class="page">
					<div class="page-content login-screen-content">
						<div class="login-screen-title">Login</div>
						<div class="list">
							<ul>
								<li class="item-content item-input">
									<div class="item-inner">
										<div class="item-title item-label">
											Username
										</div>
										<div class="item-input-wrap">
											<input
											type="text"
											name="username"
											placeholder="Your username"
											value="{{username}}"
											@input="updateUsername"
											/>
										</div>
									</div>
								</li>
								<li class="item-content item-input">
									<div class="item-inner">
										<div class="item-title item-label">
											Password
										</div>
										<div class="item-input-wrap">
											<input
											type="password"
											name="password"
											placeholder="Your password"
											value="{{password}}"
											@input="updatePassword"
											/>
										</div>
									</div>
								</li>
							</ul>
						</div>
						<div class="list">
							<ul>
								<li>
									<a
									href="#"
									class="item-link list-button login-button"
									@click="alertLoginData"
									>Sign In</a
									>
								</li>
							</ul>
							<div class="block-footer">
								Some text about login information.<br />Click
								"Sign In" to close Login Screen
							</div>
						</div>
					</div>
				</div>
			</div>
		</div> -->
	</div>
</template>
<script>
	import $$ from "dom7";
	export default {
		data() {
			return {
				user: {
					firstName: "John",
					lastName: "Doe",
				},
				// Login screen demo data
				username: "",
				password: "",
			};
		},
		methods: {
			helloWorld() {
				this.$f7.dialog.alert("Hello World!");
			},
			updateUsername(e) {
				this.username = e.target.value;
				this.$update();
			},
			updatePassword(e) {
				this.password = e.target.value;
				this.$update();
			},
			alertLoginData() {
				this.$f7.dialog.alert("Username: " + this.username + "<br>Password: " + this.password, () => {
					this.$f7.loginScreen.close();
				});
			},
		},
		on: {
			pageInit: async function(){
				var self = this;
				var app = self.$app;
				
				var loggedUser = await app.methods.getLocalValue('loggedUser');
				console.log(loggedUser);
				updateControls();
				
				$$("#sign-out-btn").on("click", async function(e){
					e.preventDefault();
					
					console.log("Logging out");
					if (await app.methods.setLocalValueToKey(null, 'loggedUser'))
					{
						console.log("Successfully logged out!");
						app.views.main.router.navigate({ name: "login" });
					}
				})
				
				function updateControls()
				{
					if (loggedUser != null)
					{
						// document.getElementById("logged-user-name").innerHTML("Asd");
						var currentMembership = loggedUser.currentMembership;
						// console.log("Current membership");
						// console.log(currentMembership);
						if(currentMembership === null)
						{
							currentMembership = "No Membership";
						}
						else
						{
							currentMembership = loggedUser.currentMembership.plan.name + " membership";
						}
						
						// console.log("Setting stuff");
						console.log("user-name instances");
						console.log($$("#logged-user-name"));
						$$("#side-logged-user-name")[0].textContent = loggedUser.username;
						$$("#side-logged-user-membership")[0].textContent = currentMembership;
						$$("#side-logged-user-picture")[0].src = `${app.data.server}${loggedUser.profilePicture.url}`;
						
						// console.log("Changing href");
						// console.log($$("#app-plan-button")[0].href);
						$$("#app-plan-button")[0].href = `/membership/view/user/${loggedUser.id}`;
						// console.log("Changed???");
						// console.log($$("#app-plan-button")[0].href);
						
						// "http://localhost:1337/uploads/profile_8818aa9129.png" 
						// loggedUser.profilePicture.url;
						// $$("#logged-user-name")[0].outerText("ASd");
					}
				}
			},
		},
	};
</script>